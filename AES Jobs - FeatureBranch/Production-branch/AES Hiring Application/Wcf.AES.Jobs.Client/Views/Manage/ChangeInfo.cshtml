@model WcfAESJobs.Client.Models.UserInfoViewModel
@using reCAPTCHA.MVC
@{
    ViewBag.Title = "Edit Profile";
}

<script type="text/javascript" src="/scripts/jquery.js"></script>
<script type="text/javascript" src="/scripts/moment.min.js"></script>
<script type="text/javascript" src="/scripts/bootstrap.min.js"></script>
<script type="text/javascript" src="/scripts/bootstrap-datetimepicker.js"></script>
<link rel="stylesheet" href="/Content/bootstrap-datetimepicker.css" />
<link rel="stylesheet" href="~/Content/font-awesome.css" />


<link href="@Url.Content("~/Content/jquery.steps.css")" rel="stylesheet" type="text/css" />
<style>
    form label.error {
        font: 10px Tahoma,sans-serif;
        color: #ED7476;
        margin-left: 5px;
        display: inline;
    }



    @@media (max-width: 700px) {
        .wizard > .steps > ul > li {
            width: 50%;
        }

        .wizard > .steps a,
        .wizard > .steps a:hover,
        .wizard > .steps a:active {
            margin-top: 0.5em;
        }

        .wizard.vertical > .steps,
        .wizard.vertical > .actions {
            display: block;
            float: none;
            width: 100%;
        }

        .wizard.vertical > .content {
            display: block;
            float: none;
            margin: 0 0.5em 0.5em;
            width: auto;
        }
    }

    @@media (max-width: 480px) {
        .wizard > .steps > ul > li {
            width: 100%;
        }
    }

    .curveunderheader {
        border-bottom-left-radius: .5em;
        border-bottom-right-radius: .5em;
        margin-top: 0;
        min-height: 40px;
        padding: .5%;
        padding-left: 1%;
        color: #2d6987;
        background-color: #d9edf7;
        font-size: 20px;
    }
</style>


<div class="curveunderheader"><span class="glyphicon glyphicon-folder-open"></span>&nbsp;&nbsp;Change Info</div>
<br />

@Html.ValidationSummary("", new { @class = "text-danger" }) <br />

@using (Html.BeginForm("ChangeInfo", "Manage", FormMethod.Post, new { @class = "form-horizontal", role = "form", id = "UpdateForm" }))
{
    @Html.AntiForgeryToken()





    <h3>Profile</h3>
    <fieldset>
        <legend>Profile Information</legend>

        @Html.HiddenFor(model => model.Email)
        <div class="form-group">
            @Html.LabelFor(model => model.First_Name, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <div class='input-group'>
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-user"></span>
                    </span>
                    @Html.TextBoxFor(model => model.First_Name, new { @class = "form-control", @readonly = "readonly" })
                </div>
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Last_Name, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <div class='input-group'>
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-user"></span>
                    </span>
                    @Html.TextBoxFor(model => model.Last_Name, new { @class = "form-control", @readonly = "readonly" })
                </div>
            </div>
        </div>


        <div class="form-group">
            @Html.LabelFor(model => model.Address1, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <div class='input-group'>
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-home"></span>
                    </span>
                    @Html.EditorFor(model => model.Address1, new { htmlAttributes = new { @class = "form-control", required = "required" } })
                </div>
            </div>
        </div>




        <div class="form-group">
            @Html.LabelFor(model => model.Address2, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <div class='input-group'>
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-home"></span>
                    </span>
                    @Html.EditorFor(model => model.Address2, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>
        </div>





        <div class="form-group">
            @Html.LabelFor(model => model.City, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <div class='input-group'>
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-home"></span>
                    </span>
                    @Html.EditorFor(model => model.City, new { htmlAttributes = new { @class = "form-control", required = "required" } })
                </div>
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.State, new { @class = "col-md-2 control-label" })
            <div class="col-md-10">
                <div class='input-group'>
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-map-marker"></span>
                    </span>
                    @Html.DropDownList("State", null, new { @class = "form-control", required = "required" })

                </div>
                @Html.ValidationMessageFor(m => m.State)
            </div>

        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Zip, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <div class='input-group'>
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-home"></span>
                    </span>
                    @Html.EditorFor(model => model.Zip, new { htmlAttributes = new { @class = "form-control", required = "required" } })
                </div>
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.Phone, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <div class='input-group'>
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-phone"></span>
                    </span>
                    @Html.EditorFor(model => model.Phone, new { htmlAttributes = new { @class = "form-control", required = "required" } })
                </div>
            </div>
        </div>
        @*<div class="form-group">
                @Html.LabelFor(m => m.DOB, new { @class = "col-md-2 control-label" })
                <div class="col-md-10">
                    @Html.TextBoxFor(m => m.DOB, new { @class = "form-control", required = "required" })
                </div>
            </div>*@

        <br />

        @*<div class="form-group">
                <div class="col-md-offset-2 col-md-10">
                    <input type="submit" class="btn btn-default" value="Register" />
                </div>
            </div>*@
    </fieldset>
    <h3>Work History</h3>
    <fieldset>
        <legend>Work Information</legend>

        <div id="editorRows">


            @if (Model.WorkHistory.Capacity > 0)
            {
                foreach (var item in Model.WorkHistory)
                {
                    Html.RenderPartial("~/Views/Account/_WorkHistoryPartial.cshtml", item, new ViewDataDictionary(ViewData) {
                        {"prefix", "WorkHistories"}
                    });

                }
            }



        </div>
        <div class="col-md-3">
            @Html.ActionLink("Add Work", "BlankEditorRow", null, new { id = "addItem", @class = "btn btn-sm btn-info" })

        </div>
    </fieldset>

    <h3>Education History</h3>
    <fieldset>
        <legend>Education Information</legend>

        <div id="EducationRows">


            @if (Model.EducationHistory.Capacity > 0)
            {
                foreach (var item in Model.EducationHistory)
                {

                    Html.RenderPartial("~/Views/Account/_EducationHistoryPartial.cshtml", item, new ViewDataDictionary(ViewData) {
                        {"prefix", "EducationHistories"}
                    });
                }
            }



        </div>
        <div class="col-md-4">
            @Html.ActionLink("Add Education", "BlankEducationRow", null, new { id = "addEducation", @class = "btn btn-sm btn-info" })

        </div>
    </fieldset>


}

<div>
    @Html.ActionLink("Back to Profile", "Index", "", new { @class = "btn btn-default" })
</div>





<script src="@Url.Content("~/Scripts/jquery.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.steps.js")" type="text/javascript"></script>

<script>
    $(document).ready(function () {
        $("#addItem").click(function () {
            $.ajax({
                url: this.href,
                cache: false,
                success: function (partialView) { $("#editorRows").append(partialView); adjustIframeHeight(); resizeJquerySteps(); }
            });
            return false;
        });
        $("#addEducation").click(function () {
            $.ajax({
                url: this.href,
                cache: false,
                success: function (partialView) { $("#EducationRows").append(partialView); adjustIframeHeight(); resizeJquerySteps(); }
            });
            return false;
        });


    });
    function deleteContainer(evt) {
        evt = evt || window.event;
        var target = evt.target || evt.srcElement;
        target.parentNode.parentNode.removeChild(target.parentNode);

        adjustIframeHeight(); resizeJquerySteps();
    };


    var form = $("#UpdateForm").show();
    function get_action(form) {
        var v = grecaptcha.getResponse();
        if (v.length === 0) {
            document.getElementById('captcha').innerHTML = "You can't leave Captcha Code empty";
            return false;
        }
        if (v.length !== 0) {
            document.getElementById('captcha').innerHTML = "Captcha completed";
            return true;
        }
    }

    function resizeJquerySteps() {
        $('.wizard .content').animate({ height: $('.body.current').outerHeight() }, "slow");
    }

    function adjustIframeHeight() {
        var $body = $('body'),
            $iframe = $body.data('iframe.fv');
        if ($iframe) {
            // Adjust the height of iframe
            $iframe.height($body.height());
        }
    }



    form.steps({
        headerTag: "h3",
        bodyTag: "fieldset",
        transitionEffect: "slideLeft",
        onStepChanging: function (event, currentIndex, newIndex) {

            // Allways allow previous action even if the current form is not valid!
            if (currentIndex > newIndex) {
                return true;
            }
            // Forbid next action on "Warning" step if the user is to young
            if (newIndex === 3) {
                return false;
            }
            // Needed in some cases if the user went back (clean up)
            if (currentIndex < newIndex) {
                // To remove error styles
                form.find(".body:eq(" + newIndex + ") label.error").remove();
                form.find(".body:eq(" + newIndex + ") .error").removeClass("error");
            }

            form.validate().settings.ignore = ":disabled,:hidden";
       
            return form.valid();


        },
        onStepChanged: function (event, currentIndex, priorIndex) {

            // Used to skip the "Warning" step if the user is old enough.
            //if (currentIndex === 2) {
            //    form.steps("next");


            //}
            // Used to skip the "Warning" step if the user is old enough and wants to the previous step.
            //if (currentIndex === 2 && priorIndex === 3) {
            //    form.steps("previous");
            //}
         
        },
        onFinishing: function (event, currentIndex) {
            form.valid();
           
            form.validate().settings.ignore = ":disabled";

            return form.valid();


        },
        onFinished: function (event, currentIndex) {

            //$("#RegisterForm").submit(function (event) {
            //    $("#RegisterForm").text("Form has been submitted!");
            //    event.preventDefault();
            //});

            var form = $(this);

            // Submit form input

            form.submit();



            //$("#RegisterForm").text("Form has been submitted!");
        }
    });
</script>
